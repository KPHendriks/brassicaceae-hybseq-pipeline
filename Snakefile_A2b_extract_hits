# variables for every species
SAMPLES = "S0377 S0301 SRR8528399".split()

calculate_avcov = []
extract_hits_psl = []
calc_id_contigs = []
for sample in SAMPLES:
    calculate_avcov.append("results/A04_mapped_contigs/{sample}/var/{sample}_average_coverage.txt".format(sample=sample))
    extract_hits_psl.append("results/A07_mapped_exons/{sample}/stats/sequenced_exons.txt".format(sample=sample))
    calc_id_contigs.append("results/A06_identified_contigs_blat/{sample}/stats/identified_contigs.txt".format(sample=sample))


rule all:
    input:
        calculate_avcov,
        extract_hits_psl,
        calc_id_contigs

rule calculate_avcov:
    input:
        script = "src/calculate_average_coverage.py"
    output:
        "results/A04_mapped_contigs/{sample}/var/{sample}_average_coverage.txt"
    params:
        sample = "{sample}"
    shell:
        "python {input.script} {params.sample}"

rule extract_hits_psl:
    input:
        script = "src/extract_hits_psl.py"
        # file = "results/A06_identified_contigs_blat/{sample}/contig{nr}_AT.psl"
    output:
        "results/A07_mapped_exons/{sample}/stats/sequenced_exons.txt"
    params:
        sample = "{sample}"
    shell:
        "python {input.script} {params.sample}"

rule calc_identified_contigs:
    input:
         file = "results/A06_identified_contigs_blat/{sample}/stats/highest_hits_filtered.txt"
    output:
         file = "results/A06_identified_contigs_blat/{sample}/stats/identified_contigs.txt"
    shell:
        "echo $(cat {input.file} | wc -l) - 1 | bc > {output.file}"
